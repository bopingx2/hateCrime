# Data

## Sources

Our original data file `Hate_Crime.csv` is from FBI Crime data Explorer (CDE) (<https://crime-data-explorer.fr.cloud.gov/pages/home>). According to the description provided along with the file, the data was collected through FBI's Uniform Crime Reporting (UCR) Program. UCR is a program aimed to provide reliable crime statistics for public use. There are approximately 18,000 law enforcement units in the US participate in this program. Each unit voluntarily send their data through National Incident-Based Reporting System (NIBRS), which allows them provide detailed information of a crime such as offenders' bias against specific social identity. At the end of each year, FBI will release the data a year before with multiple section through CDE and Hate Crime Statistics is a dedicated collection along with others.

```{r}
library(tidyverse)
hate = read.csv("resource/hate_crime.csv")
str <- sprintf("The dimension of the dataset is %d rows and %d columns.\n",
               dim(hate)[1], dim(hate)[2])
cat(str)
cat("The columns' names are:\n")
names(hate)
```

As we discover, the data has 219577 rows and 28 columns. Most of the variables are categorical. `INCIDENT_ID`, `ADULT_VICTIM_COUNT`, `JUVENILE_VICTIM_COUNT`, `TOTAL_OFFENDER_COUNT`, `ADULT_OFFENDER_COUNT`, `JUVENILE_OFFENDER_COUNT`, `VICTIM_COUNT`, and `TOTAL_INDIVIDUAL_VICTIMS` are continuous variables. `DATA_YEAR` and `INCIDENT_DATE` should be date variables, but they are stored in `int` and `chr`.

Although FBI provided a very large and detailed dataset, it contains several issues. The most important one, as stated by FBI, because the motivation of a crime is a subjective factor, it is difficult to determine whether the crime is because of offenders' bias. Hence, law enforcement conclude a hate crime only if there are sufficient evidence to prove it. This resulting in underestimating overall occurrence of hate crimes but it could guarantee the accuracy of our analysis. As we understanding and interpreting dataset, we found some problem regarding the quality of the dataset. There are multiple columns contains value of empty string instead of `NA`, which leads to a erroneous missing value analysis. In the `OFFENSE_NAME` and `BIAS_DESC` column, some observation contains multiple variables. These situations are indicated in `MULTIPLE_OFFENSE` and `MULTIPLE_BIAS`. It is reasonable for a crime aiming to multiple group of people with several offense, but it creates obstacles when analyzing offense type and bias. There are other problems, like `TOTAL_OFFENDER_COUNT` contains a huge portion of 0s and adults and juveniles partition are not reported before 2011. Since we dropped these columns, we do not dig into the reason of these problems.

## Cleaning / transformation

First cleaning step is to extract columns needed for out target. We have already mentioned our goal in the introduction section, here we just select related column and reduced it to 7 columns.

```{r}
hate_select <- hate |>
  select(c(INCIDENT_ID, STATE_NAME, REGION_NAME, INCIDENT_DATE,
           OFFENDER_RACE, OFFENSE_NAME, BIAS_DESC))
hate_clean_na <- hate_select
str <- sprintf("The dimension of the dataset is %d rows and %d columns.\n", 
        dim(hate_select)[1], dim(hate_select)[2])
cat(str)
cat("The columns' names are:\n")
names(hate_select)
```

Next we will split the row with multiple `BIAS_DESC` and `OFFENSE_NAME`. Before the split, the unique entries in `BIAS_DESC` and `OFFENSE_NAME` are 279 and 353. After the split, the unique entries in `BIAS_DESC` and `OFFENSE_NAME` are reduced to 35 and 48. Note that this will create multiple rows for one crime and can leads to over counting. We will only count crime with distinct `INCIDENT_ID` to overcome this issue.

```{r}
cat("BEFORE\n")
str <- sprintf("The unique BIAS_DESC counts is: %d.\n",
               length(unique(hate_select$BIAS_DESC)))
cat(str)
str <- sprintf("The unique OFFENSE_NAME counts is: %d.\n",
        length(unique(hate_select$OFFENSE_NAME)))
cat(str)
hate_split <- hate_select |>
  separate_rows(BIAS_DESC, sep = ";") |>
  separate_rows(OFFENSE_NAME, sep = ";")
cat("AFTER\n")
str <- sprintf("The unique BIAS_DESC counts is: %d.\n",
        length(unique(hate_split$BIAS_DESC)))
cat(str)
str <- sprintf("The unique OFFENSE_NAME counts is: %d.\n",
        length(unique(hate_split$OFFENSE_NAME)))
cat(str)
str <- sprintf("The dimension of the dataset is %d rows and %d columns.\n", 
        dim(hate_split)[1], dim(hate_split)[2])
cat(str)
```

A strange pattern in `BIAS_DESC` is that while it contains `Anti-Lesbian (Female)`, `Anti-Gay (Male)`, `Anti-Bisexual`, and `Anti-Transgender` separately, it also has a entry `Anti-Lesbian, Gay, Bisexual, or Transgender (Mixed Group)`. We will combine the separate listings into the mixed one.

```{r}
hate_comb <- hate_split |>
  mutate(BIAS_DESC =
           replace(BIAS_DESC, 
                   BIAS_DESC == "Anti-Lesbian (Female)",
                   "Anti-Lesbian, Gay, Bisexual, or Transgender (Mixed Group)")) |>
  mutate(BIAS_DESC =
           replace(BIAS_DESC, 
                   BIAS_DESC == "Anti-Gay (Male)",
                   "Anti-Lesbian, Gay, Bisexual, or Transgender (Mixed Group)")) |>
  mutate(BIAS_DESC =
           replace(BIAS_DESC, 
                   BIAS_DESC == "Anti-Bisexual",
                   "Anti-Lesbian, Gay, Bisexual, or Transgender (Mixed Group)")) |>
  mutate(BIAS_DESC =
           replace(BIAS_DESC, 
                   BIAS_DESC == "Anti-Transgender",
                   "Anti-Lesbian, Gay, Bisexual, or Transgender (Mixed Group)"))
str <- sprintf("The unique BIAS_DESC counts is: %d.\n",
               length(unique(hate_comb$BIAS_DESC)))
cat(str)
```

The `INCIDENT_DATE` is stored as `character` class. We need to change it into `Date` class.

```{r}
cat("BEFORE\n")
str <- sprintf("The class of INCIDENT_DATE is : %s.\n",
               class(hate_comb$INCIDENT_DATE))
cat(str)
hate_clean <- hate_comb |>
  mutate(INCIDENT_DATE = as.Date(INCIDENT_DATE, "%d-%b-%y"))
cat("AFTER\n")
str <- sprintf("The class of INCIDENT_DATE is : %s.\n",
               class(hate_clean$INCIDENT_DATE))
cat(str)
```

Last step is to process empty string. We consider it as `NA`. And because empty string only happens in categorical variables, we will replace it with `Unknown`.

```{r}
cat("BEFORE\n")
str <- sprintf("The number of rows with empty string is : %d.\n",
               dim(filter_all(hate_clean, any_vars(. == "")))[1])
cat(str)
hate_clean[hate_clean == ""] <- "Unknown"
cat("AFTER\n")
str <- sprintf("The number of rows with empty string is : %d.\n",
               dim(filter_all(hate_clean, any_vars(. == "")))[1])
cat(str)
```

## Missing value analysis

Since our data set is gigantic, we cannot use either heat map nor `mi` library to plot and interpret missing pattern. Here we will using `redav` library provided by Professor Robbins to plot the missing patters. To better visualize the graph, we changed column name into its index. We also transform all empty string into `NA`.

```{r}
library(redav)
hate_na <- hate
colnames(hate_na) <- as.character(c(1:28))
hate_clean_na <- hate_na |>
  select(c(1, 8, 10, 13, 19, 22, 25))
hate_na[hate_na == ""] <- NA
hate_clean_na[hate_clean_na == ""] <- NA
```

For the raw dataset, the missing pattern seems pretty messy. However it shows that about 95% rows are missing `PUB_AGENCY_UNIT`, 80% rows are missing `OFFENDER_ETHNICITY`, 75% rows are missing `ADULT_VICTIM_COUNT`, `JUVENILE_VICTIM_COUNT`, `ADULT_OFFENDER_COUNT`, and `JUVENILE_OFFENDER_COUNT`. It is not surprised that `PUB_AGENCY_UNIT` has a huge number of missing because after we dig into the dataset, `PUB_AGENCY_UNIT` are only provided when the unit is affiliated to a bigger law enforcement, like university or state police. Aside of that, the other five columns usually missing together. While checking the dataset, we found that all of the rows are missing these five values until 2013. After 2013, some of them are still missing, but gradually decreased. We think a possible explanation is that prior to 2013, FBI did not require law enforcement report these data. After 2013, FBI required to provide these information and some law enforcement respond to it immediately, while others may have some difficulties in submitting these data but eventually they all comply with the FBI requirement. In addition to these major columns missing, `TOTAL_INDIVIDUAL_VICTIMS` and `OFFENDER_RACE` also have some minor missing but they don't have correlation, which seems to be happened completely at random.

```{r}
plot_missing(hate_na)
```

The cleaned data only has one missing pattern, and only has a negligible amount of missing. The missing column is `OFFENDER_RACE` and in the cleaning part we have already counted there only 20 missing value. We found that `OFFENDER_RACE` has a entry `Unknown`. Therefore, we will replace `NA` with `Unknown`.

```{r}
plot_missing(hate_clean_na)
```